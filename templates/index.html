{% extends "base.html" %}
{% block content %}

<header>
    <h3>Welcome!</h3>
    <p>
        Lorem ipsum dolor sit amet, consectetuer adipiscing elit,
        sed diam nonummy nibh euismod tincidunt ut laoreet dolore
        magna aliquam erat volutpat. Ut wisi enim ad minim veniam,
        quis nostrud exerci tation ullamcorper suscipit lobortis nisl
        ut aliquip ex ea commodo consequat. Duis autem vel eum iriure
        dolor in hendrerit in vulputate velit esse molestie consequat,
        vel illum dolore eu feugiat nulla facilisis at vero eros et
        accumsan et iusto odio dignissim qui blandit praesent luptatum
        zzril delenit augue duis dolore te feugait nulla facilisi.
    </p>
</header>

<section class="row content">
    <div class="col-lg-6 offset-lg-3 col-sm-12">
        <form class="search-form" action="{{ url_for('search_result') }}">
            <div class="form-group">
                <input class="form-control main-search" id="search_term" name="search_term" type="search" placeholder="Search Something?">
            </div>
            <div class="d-flex justify-content-center">
                <button class="btn search-btn" type="submit">Search</button>
            </div>
        </form>
    </div>
    <div class="col-lg-3 col-sm-12">
        <h6>Quick Searchs</h6>
        <div class="row justify-content-center">
            {% for genre in genres %}
            <a href="{{ url_for('filter_by_genre', search_term=genre, filter_by=genre) }}">
                <button class="btn quick-search">{{ genre }}</button>
            </a>
            {% endfor %}
        </div>
    </div>
</section>



<section class="row content">
    <article class="col-lg-8 featured-book-lg">
        <div class="row">
            <div class="col-lg-5">
                <img class="featured-img" src="{{ url_for('static', filename='images/book_cover_coming.jpg') }}" alt="No Image Available"></img>
            </div>
            <div class="col-lg-7">
                <div class="featured-header">
                    <h4>Featured Book</h4>
                    <h5 class="featured-title">{{ featured.title }}</h5>
                    <h5> By {{ featured.author }}</h5>
                </div>
                <div class="featured-body">
                    <p>{{ featured.blurb }}</p>
                    <a href="{{ url_for('book_record', book_id=featured._id) }}">
                        <button class="btn featured-btn" >View Book</button>
                    </a>
                </div>
            </div>
        </div>
    </article>
    <article class="col-sm-12 featured-book-sm">
        <div class="row">
            <div class="col-sm-6">
                <img class="featured-img" src="{{ url_for('static', filename='images/book_cover_coming.jpg') }}" alt="No Image Available"></img>
            </div>
            <div class="col-sm-6">
                <div class="featured-header">
                    <h4>Featured Book</h4>
                    <h5 class="featured-title">{{ featured.title }}</h5>
                    <h5> By {{ featured.author }}</h5>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12 featured-body">
                <p>{{ featured.blurb }}</p>
                <a href="{{ url_for('book_record', book_id=featured._id) }}">
                    <button class="btn featured-btn" >View Book</button>
                </a>
            </div>
        </div>
    </article>
    <article class="col-sm-12 col-lg-4 about-body">
        <h4 class="about-header">About</h4>
        <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit,
        sed diam nonummy nibh euismod tincidunt ut laoreet dolore
        magna aliquam erat volutpat. Ut wisi enim ad minim veniam,
        quis nostrud exerci tation ullamcorper suscipit lobortis nisl
        ut aliquip ex ea commodo consequat. Duis autem vel eum iriure
        dolor in hendrerit in vulputate velit esse molestie consequat,
        vel illum dolore eu feugiat nulla facilisis at vero eros et
        accumsan et iusto odio dignissim qui blandit praesent luptatum
        zzril delenit augue duis dolore te feugait nulla facilisi.</p>
    </article>
</section>

<section class="row content">
    <article class="col-sm-12 col-lg-5">
        <h6 class="chart-title">Most Viewed By Genre</h6>
        <div id="pie_chart" class="charts"></div>
    </article>
    <article class="col-sm-12 col-lg-7">
        <h6 class="chart-title">Most Viewed By Title</h6>
        <div id="row_chart" class="charts"></div>
    </article>
</section>
    
    

<script>

    var pie_chart = dc.pieChart("#pie_chart")
    var row_chart = dc.rowChart("#row_chart");
    
    
    var most_viewed = {{ most_viewed | tojson | safe }};
    
    var ndx = crossfilter(most_viewed),
        title = ndx.dimension(function(d) {return d.title;}),
        viewsGroup = title.group().reduceSum(function(d) {return +d.views;}),
        genre = ndx.dimension(function(d) {return d.genre;}),
        genreByCount = genre.group()
        
        
    pie_chart
        .height(400)
        .radius(160)
        .dimension(genre)
        .group(genreByCount)
        .ordinalColors(['#3182bd', '#6baed6', '#9ecae1', '#c6dbef', '#dadaeb'])
   
    row_chart
        .height(400)
        .margins({top: 5, right: 5, bottom: 5, left: 5})
        .ordinalColors(['#3182bd', '#6baed6', '#9ecae1', '#c6dbef', '#dadaeb'])
        .x(d3.scaleLinear().domain([6,20]))
        .xAxis(d3.axisTop())
        .elasticX(true)
        .dimension(title)
        .group(viewsGroup);
        
        
    row_chart.on('pretransition', function() {
        row_chart.select('g.axis').attr('transform', 'translate(0,0)');
        row_chart.selectAll('line.grid-line').attr('y2', row_chart.effectiveHeight());
    });
    
    dc.renderAll();
    
</script>
{% endblock %}